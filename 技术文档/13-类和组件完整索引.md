# 13-类和组件完整索引

## 1. 核心类

### 1.1 EditorEngine

**位置**: `src/engine/EditorEngine.ts`

**成员变量**:
```typescript
private layoutManager: LayoutManager
private windowManager: WindowManager
private fileManager: FileManager
private dragDropHandler: DragDropHandler
private saveManager: SaveManager
private eventBus: EventBus
private kernel: Kernel
private container: HTMLElement
private config: EditorConfig
```

**公共方法**: 见API索引

---

### 1.2 LayoutManager

**位置**: `src/engine/LayoutManager.ts`

**成员变量**:
```typescript
private layouts: Map<string, LayoutPluginInfo>
private currentLayout: LayoutPlugin | null
private container: HTMLElement
private context: LayoutContext
private eventBus: EventBus
private savedStates: Map<string, LayoutState>
```

---

### 1.3 WindowManager

**位置**: `src/engine/WindowManager.ts`

**成员变量**:
```typescript
private windows: Map<string, Window>
private focusedWindowId: string | null
private nextZIndex: number
private zIndexOrder: string[]
private eventBus: EventBus
```

---

### 1.4 FileManager

**位置**: `src/engine/FileManager.ts`

**成员变量**:
```typescript
private files: Map<string, File>
private basePath: string
private eventBus: EventBus
private watcher: FSWatcher | null
```

---

### 1.5 DragDropHandler

**位置**: `src/engine/DragDropHandler.ts`

**成员变量**:
```typescript
private currentDrag: DragState | null
private dropTargets: Map<string, DropTarget>
private dragPreview: HTMLElement | null
private eventBus: EventBus
```

---

### 1.6 SaveManager

**位置**: `src/engine/SaveManager.ts`

**成员变量**:
```typescript
private fileManager: FileManager
private eventBus: EventBus
private dirtyFiles: Set<string>
private saveQueue: SaveTask[]
private saveTimer: NodeJS.Timeout | null
private interval: number
```

---

### 1.7 EventBus

**位置**: `src/engine/EventBus.ts`

**成员变量**:
```typescript
private events: Map<string, Set<EventHandler>>
```

---

## 2. 布局组件 (React)

### 2.1 InfiniteCanvasLayout

**位置**: `src/layouts/infinite-canvas/InfiniteCanvasLayout.tsx`

**Props**:
```typescript
interface InfiniteCanvasProps {
  context: LayoutContext;
}
```

**子组件**:
- `DesktopLayer` - 桌面层
- `WindowLayer` - 窗口层
- `Dock` - 工具栏
- `ZoomSlider` - 缩放控制

---

### 2.2 WorkbenchLayout

**位置**: `src/layouts/workbench/WorkbenchLayout.tsx`

**Props**:
```typescript
interface WorkbenchProps {
  context: LayoutContext;
}
```

**子组件**:
- `Sidebar` - 侧边栏
- `FileTree` - 文件树
- `PreviewArea` - 预览区
- `EditPanel` - 编辑面板
- `TabBar` - 标签栏

---

## 3. 窗口组件

### 3.1 CardWindow

**位置**: `src/ui/components/CardWindow.tsx`

**Props**:
```typescript
interface CardWindowProps {
  id: string;
  title: string;
  position: { x: number; y: number };
  size: { width: number; height: number };
  state?: WindowState;
  zIndex?: number;
  onClose?: (id: string) => void;
  onFocus?: (id: string) => void;
  onDragStart?: (id: string) => void;
  children?: React.ReactNode;
}
```

---

### 3.2 ToolWindow

**位置**: `src/ui/components/ToolWindow.tsx`

**Props**:
```typescript
interface ToolWindowProps {
  id: string;
  title: string;
  position: { x: number; y: number };
  size: { width: number; height: number };
  resizable?: boolean;
  children?: React.ReactNode;
}
```

---

## 4. 基础UI组件

### 4.1 Button

```typescript
interface ButtonProps {
  variant?: 'primary' | 'secondary' | 'danger';
  size?: 'small' | 'medium' | 'large';
  disabled?: boolean;
  onClick?: () => void;
  children: React.ReactNode;
}
```

### 4.2 Input

```typescript
interface InputProps {
  value: string;
  onChange: (value: string) => void;
  placeholder?: string;
  type?: 'text' | 'password' | 'email';
  disabled?: boolean;
}
```

### 4.3 Dialog

```typescript
interface DialogProps {
  open: boolean;
  title: string;
  onClose: () => void;
  children: React.ReactNode;
}
```

### 4.4 Toast

```typescript
interface ToastProps {
  message: string;
  type: 'success' | 'error' | 'warning' | 'info';
  duration?: number;
  onClose?: () => void;
}
```

### 4.5 ContextMenu

```typescript
interface ContextMenuProps {
  items: MenuItem[];
  position: { x: number; y: number };
  onClose: () => void;
}

interface MenuItem {
  label: string;
  icon?: string;
  disabled?: boolean;
  onClick?: () => void;
  children?: MenuItem[];
}
```

---

## 5. 布局组件

### 5.1 Flex

```typescript
interface FlexProps {
  direction?: 'row' | 'column';
  justify?: 'start' | 'center' | 'end' | 'space-between';
  align?: 'start' | 'center' | 'end' | 'stretch';
  gap?: number;
  children: React.ReactNode;
}
```

### 5.2 Grid

```typescript
interface GridProps {
  columns?: number;
  rows?: number;
  gap?: number;
  children: React.ReactNode;
}
```

---

## 6. 状态管理 (Zustand)

### 6.1 useEditorStore

```typescript
interface EditorStore {
  // 窗口状态
  windows: Map<string, Window>;
  focusedWindowId: string | null;
  
  // 文件状态
  files: Map<string, File>;
  currentFileId: string | null;
  
  // 布局状态
  currentLayout: string;
  
  // Actions
  createWindow: (options: WindowOptions) => Window;
  closeWindow: (windowId: string) => void;
  focusWindow: (windowId: string) => void;
  
  openFile: (fileId: string) => void;
  closeFile: (fileId: string) => void;
  
  switchLayout: (layoutId: string) => void;
}

const useEditorStore = create<EditorStore>((set, get) => ({
  // ... 实现
}));
```

---

## 7. React Hooks

### 7.1 useWindow

```typescript
function useWindow(windowId: string) {
  const window = useEditorStore(state => state.windows.get(windowId));
  const updateWindow = useEditorStore(state => state.updateWindow);
  
  return { window, updateWindow };
}
```

### 7.2 useFile

```typescript
function useFile(fileId: string) {
  const file = useEditorStore(state => state.files.get(fileId));
  const updateFile = useEditorStore(state => state.updateFile);
  
  return { file, updateFile };
}
```

### 7.3 useDragDrop

```typescript
function useDragDrop(config: DragDropConfig) {
  const { sensors, collisionDetection } = useDndKit();
  
  const handleDragStart = (event: DragStartEvent) => {
    // ...
  };
  
  const handleDragEnd = (event: DragEndEvent) => {
    // ...
  };
  
  return { handleDragStart, handleDragEnd };
}
```

---

## 8. 类型定义

### 8.1 Window Types

```typescript
interface Window {
  id: string;
  type: WindowType;
  fileId?: string;
  position: { x: number; y: number };
  size: { width: number; height: number };
  state: WindowState;
  zIndex: number;
  layer: 'desktop' | 'window';
}

type WindowType = 'card' | 'box' | 'tool';
type WindowState = 'expanded' | 'collapsed' | 'cover' | 'minimized';
```

### 8.2 File Types

```typescript
interface File {
  id: string;
  name: string;
  type: FileType;
  path: string;
  created: Date;
  modified: Date;
  size: number;
}

type FileType = 'card' | 'box' | 'folder';
```

---

## 9. 完整组件树

```
EditorEngine
├── LayoutManager
│   └── LayoutPlugin (动态)
│       ├── InfiniteCanvasLayout
│       │   ├── DesktopLayer
│       │   ├── WindowLayer
│       │   │   ├── CardWindow[]
│       │   │   └── ToolWindow[]
│       │   ├── Dock
│       │   └── ZoomSlider
│       │
│       └── WorkbenchLayout
│           ├── Sidebar
│           │   └── FileTree
│           ├── PreviewArea
│           ├── EditPanel
│           └── TabBar
│
├── WindowManager
│   └── Window[] (数据)
│
├── FileManager
│   └── File[] (数据)
│
├── DragDropHandler
│
├── SaveManager
│
└── EventBus
```

---

完整的类和组件索引为开发者提供了清晰的代码结构参考。
