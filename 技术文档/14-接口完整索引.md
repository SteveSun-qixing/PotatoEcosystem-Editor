# 14-接口完整索引

## 1. 核心接口

### 1.1 LayoutPlugin

**位置**: `src/types/plugins.ts`

```typescript
interface LayoutPlugin {
  /** 布局ID */
  id: string;
  
  /** 布局名称 */
  name: string;
  
  /** 布局版本 */
  version: string;
  
  /** 布局描述 */
  description?: string;
  
  /** 初始化布局 */
  initialize(context: LayoutContext): Promise<void>;
  
  /** 销毁布局 */
  destroy(): void;
  
  /** 创建窗口 */
  createWindow(file: File): Window;
  
  /** 保存布局状态 */
  saveState(): LayoutState;
  
  /** 恢复布局状态 */
  restoreState(state: LayoutState): void;
  
  /** 渲染布局（React组件） */
  render(): React.ReactElement;
}
```

---

### 1.2 LayoutContext

**位置**: `src/types/engine.ts`

```typescript
interface LayoutContext {
  /** 内核实例 */
  kernel: Kernel;
  
  /** 窗口管理器 */
  windowManager: WindowManager;
  
  /** 文件管理器 */
  fileManager: FileManager;
  
  /** 拖拽处理器 */
  dragDropHandler: DragDropHandler;
  
  /** 事件总线 */
  eventBus: EventBus;
  
  /** 配置 */
  config: EditorConfig;
}
```

---

### 1.3 EditorPlugin

**位置**: `src/types/plugins.ts`

```typescript
interface EditorPlugin {
  /** 插件ID */
  id: string;
  
  /** 插件名称 */
  name: string;
  
  /** 插件版本 */
  version: string;
  
  /** 支持的卡片类型 */
  cardTypes: string[];
  
  /** 初始化 */
  initialize(context: PluginContext): Promise<void>;
  
  /** 销毁 */
  destroy(): void;
  
  /** 创建编辑器组件 */
  createEditor(card: Card): React.ReactElement;
}
```

---

### 1.4 RendererPlugin

**位置**: `src/types/plugins.ts`

```typescript
interface RendererPlugin {
  /** 插件ID */
  id: string;
  
  /** 插件名称 */
  name: string;
  
  /** 支持的卡片类型 */
  cardTypes: string[];
  
  /** 渲染卡片 */
  render(card: Card): React.ReactElement;
  
  /** 获取预览 */
  getPreview(card: Card): string | React.ReactElement;
}
```

---

## 2. 窗口接口

### 2.1 Window

**位置**: `src/types/window.ts`

```typescript
interface Window {
  /** 窗口ID */
  id: string;
  
  /** 窗口类型 */
  type: WindowType;
  
  /** 关联的文件ID */
  fileId?: string;
  
  /** 窗口位置 */
  position: { x: number; y: number };
  
  /** 窗口大小 */
  size: { width: number; height: number };
  
  /** 窗口状态 */
  state: WindowState;
  
  /** z-index */
  zIndex: number;
  
  /** 所属层 */
  layer: 'desktop' | 'window';
  
  /** 最小尺寸 */
  minSize?: { width: number; height: number };
  
  /** 最大尺寸 */
  maxSize?: { width: number; height: number };
  
  /** 是否可调整大小 */
  resizable?: boolean;
  
  /** 是否可拖动 */
  draggable?: boolean;
}

type WindowType = 'card' | 'box' | 'tool';
type WindowState = 'expanded' | 'collapsed' | 'cover' | 'minimized';
```

---

### 2.2 WindowFilter

```typescript
interface WindowFilter {
  type?: WindowType;
  fileId?: string;
  layer?: 'desktop' | 'window';
  state?: WindowState;
}
```

---

## 3. 文件接口

### 3.1 File

**位置**: `src/types/file.ts`

```typescript
interface File {
  /** 文件ID */
  id: string;
  
  /** 文件名 */
  name: string;
  
  /** 文件类型 */
  type: FileType;
  
  /** 文件路径 */
  path: string;
  
  /** 创建时间 */
  created: Date;
  
  /** 修改时间 */
  modified: Date;
  
  /** 文件大小（字节） */
  size: number;
  
  /** 标签 */
  tags?: string[];
  
  /** 自定义元数据 */
  metadata?: Record<string, any>;
}

type FileType = 'card' | 'box' | 'folder';
```

---

### 3.2 FileListOptions

```typescript
interface FileListOptions {
  /** 文件类型过滤 */
  type?: FileType;
  
  /** 标签过滤 */
  tags?: string[];
  
  /** 排序字段 */
  sortBy?: 'name' | 'created' | 'modified' | 'size';
  
  /** 排序方向 */
  sortOrder?: 'asc' | 'desc';
  
  /** 分页 */
  limit?: number;
  offset?: number;
}
```

---

## 4. 拖拽接口

### 4.1 DragSource

**位置**: `src/types/events.ts`

```typescript
interface DragSource {
  /** 源ID */
  id?: string;
  
  /** 源类型 */
  type: string;
  
  /** 源数据 */
  data: any;
  
  /** 拖拽预览 */
  preview?: HTMLElement | string;
}
```

---

### 4.2 DropTarget

```typescript
interface DropTarget {
  /** 目标ID */
  id?: string;
  
  /** 接受的类型 */
  accepts: string[];
  
  /** 放置回调 */
  onDrop: (source: DragSource, event: DragEvent) => void;
  
  /** 进入回调 */
  onDragEnter?: (source: DragSource, event: DragEvent) => void;
  
  /** 离开回调 */
  onDragLeave?: (source: DragSource, event: DragEvent) => void;
  
  /** 悬停回调 */
  onDragOver?: (source: DragSource, event: DragEvent) => void;
}
```

---

### 4.3 DragState

```typescript
interface DragState {
  /** 拖拽源 */
  source: DragSource;
  
  /** 起始位置 */
  startPosition: { x: number; y: number };
  
  /** 当前位置 */
  currentPosition: { x: number; y: number };
  
  /** 当前目标 */
  currentTarget?: DropTarget;
  
  /** 是否可放置 */
  canDrop: boolean;
}
```

---

## 5. 事件接口

### 5.1 EventHandler

**位置**: `src/types/events.ts`

```typescript
type EventHandler = (data?: any) => void | Promise<void>;
```

---

### 5.2 Event

```typescript
interface Event {
  /** 事件类型 */
  type: string;
  
  /** 事件数据 */
  data?: any;
  
  /** 时间戳 */
  timestamp: number;
  
  /** 发送者 */
  sender?: string;
}
```

---

## 6. 保存接口

### 6.1 SaveStatus

**位置**: `src/types/engine.ts`

```typescript
interface SaveStatus {
  /** 是否保存中 */
  saving: boolean;
  
  /** 最后保存时间 */
  lastSaved?: Date;
  
  /** 是否有错误 */
  error?: string;
}
```

---

### 6.2 SaveTask

```typescript
interface SaveTask {
  /** 文件ID */
  fileId: string;
  
  /** 数据 */
  data: any;
  
  /** 重试次数 */
  retries: number;
  
  /** 创建时间 */
  createdAt: Date;
}
```

---

## 7. 配置接口

### 7.1 EditorConfig

**位置**: `src/types/engine.ts`

```typescript
interface EditorConfig {
  /** 数据目录路径 */
  basePath: string;
  
  /** 默认布局 */
  defaultLayout?: string;
  
  /** 自动保存间隔（毫秒） */
  autoSaveInterval?: number;
  
  /** 内核配置 */
  kernelConfig?: any;
  
  /** 主题 */
  theme?: 'light' | 'dark' | 'auto';
  
  /** 语言 */
  locale?: string;
  
  /** 调试模式 */
  debug?: boolean;
}
```

---

### 7.2 LayoutConfig

```typescript
interface LayoutConfig {
  /** 布局特定配置 */
  [key: string]: any;
}
```

---

## 8. 状态接口

### 8.1 LayoutState

**位置**: `src/types/plugins.ts`

```typescript
interface LayoutState {
  /** 布局ID */
  layoutId: string;
  
  /** 窗口状态列表 */
  windows: WindowState[];
  
  /** 视口状态 */
  viewport?: {
    x: number;
    y: number;
    scale: number;
  };
  
  /** 其他自定义状态 */
  [key: string]: any;
}
```

---

### 8.2 WindowState

```typescript
interface WindowState {
  id: string;
  position: { x: number; y: number };
  size: { width: number; height: number };
  state: 'expanded' | 'collapsed' | 'cover' | 'minimized';
  zIndex: number;
}
```

---

## 9. React Props接口

### 9.1 CardWindowProps

```typescript
interface CardWindowProps {
  id: string;
  title: string;
  position: { x: number; y: number };
  size: { width: number; height: number };
  state?: WindowState;
  zIndex?: number;
  onClose?: (id: string) => void;
  onFocus?: (id: string) => void;
  onDragStart?: (id: string, event: React.MouseEvent) => void;
  children?: React.ReactNode;
}
```

---

### 9.2 LayoutPluginProps

```typescript
interface LayoutPluginProps {
  context: LayoutContext;
}
```

---

## 10. 导出格式接口

### 10.1 ExportFormat

```typescript
type ExportFormat = 'json' | 'markdown' | 'html' | 'pdf';
```

---

### 10.2 ExportOptions

```typescript
interface ExportOptions {
  format: ExportFormat;
  includeResources?: boolean;
  compress?: boolean;
  [key: string]: any;
}
```

---

## 11. 接口继承关系

```
Plugin (基础插件接口)
├── LayoutPlugin (布局插件)
├── EditorPlugin (编辑器插件)
└── RendererPlugin (渲染器插件)

Window (窗口接口)
├── CardWindow (卡片窗口)
├── ToolWindow (工具窗口)
└── BoxWindow (箱子窗口)

File (文件接口)
├── CardFile (卡片文件)
├── BoxFile (箱子文件)
└── FolderFile (文件夹)
```

---

完整的接口索引为插件开发者提供了清晰的扩展点和类型定义。
