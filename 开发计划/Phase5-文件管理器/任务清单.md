# Phase5 - 文件管理器

**周期**: 1 周  
**优先级**: 🟡 高  
**依赖**: Phase3  
**状态**: 待开发

---

## 1. 阶段目标

实现编辑器的文件管理器组件：
- 文件树组件
- 文件操作（创建、打开、删除、重命名）
- 文件拖放支持
- 搜索过滤

---

## 2. 任务列表

### 2.1 创建文件管理器主组件

**任务 ID**: P5-T01  
**优先级**: 🔴 最高  
**预计工时**: 4h

**功能说明**:
- 显示当前工作目录的文件列表
- 支持文件夹展开/收起
- 显示卡片文件（.card）和箱子文件（.box）
- 文件图标根据类型显示

**核心代码结构**:
```typescript
// src/components/file-manager/FileManager.vue
- 文件列表显示
- 工具栏（新建、刷新、搜索）
- 上下文菜单
```

**验收标准**:
- [ ] 文件列表正确显示
- [ ] 文件夹展开/收起正常
- [ ] 文件图标正确

---

### 2.2 创建文件树组件

**任务 ID**: P5-T02  
**优先级**: 🔴 最高  
**预计工时**: 3h

**功能说明**:
- 树形结构显示文件
- 支持多选
- 支持拖放排序
- 支持键盘导航

**核心代码结构**:
```typescript
// src/components/file-manager/FileTree.vue
- TreeNode 递归组件
- 展开/收起状态管理
- 选择状态管理
```

**验收标准**:
- [ ] 树形结构正确
- [ ] 展开/收起正常
- [ ] 选择功能正常

---

### 2.3 创建文件项组件

**任务 ID**: P5-T03  
**优先级**: 🟡 高  
**预计工时**: 2h

**功能说明**:
- 单个文件项显示
- 文件图标
- 文件名（支持重命名编辑）
- 文件状态指示

**验收标准**:
- [ ] 文件项显示正确
- [ ] 重命名功能正常
- [ ] 状态指示正确

---

### 2.4 实现文件操作服务

**任务 ID**: P5-T04  
**优先级**: 🔴 最高  
**预计工时**: 3h

**功能说明**:
- 通过 SDK 进行文件操作
- 创建卡片/箱子
- 打开文件
- 删除文件（移到回收站）
- 重命名文件
- 复制/移动文件

**核心代码结构**:
```typescript
// src/core/file-service.ts
export class FileService {
  async createCard(name: string, path: string): Promise<Card>;
  async createBox(name: string, path: string): Promise<Box>;
  async openFile(path: string): Promise<void>;
  async deleteFile(path: string): Promise<void>;
  async renameFile(oldPath: string, newName: string): Promise<void>;
  async copyFile(source: string, dest: string): Promise<void>;
  async moveFile(source: string, dest: string): Promise<void>;
}
```

**验收标准**:
- [ ] 所有文件操作正常
- [ ] 错误处理完善
- [ ] 事件通知正确

---

### 2.5 实现上下文菜单

**任务 ID**: P5-T05  
**优先级**: 🟡 高  
**预计工时**: 2h

**功能说明**:
- 右键点击显示上下文菜单
- 根据选择项显示不同选项
- 支持快捷键提示

**菜单项**:
- 新建卡片
- 新建箱子
- 新建文件夹
- 打开
- 重命名
- 复制
- 剪切
- 粘贴
- 删除
- 在资源管理器中显示

**验收标准**:
- [ ] 上下文菜单显示正常
- [ ] 菜单项根据上下文变化
- [ ] 菜单操作正常

---

### 2.6 实现搜索过滤

**任务 ID**: P5-T06  
**优先级**: 🟢 中  
**预计工时**: 2h

**功能说明**:
- 搜索框输入过滤
- 支持文件名搜索
- 支持类型过滤（卡片/箱子）
- 高亮匹配文本

**验收标准**:
- [ ] 搜索功能正常
- [ ] 过滤结果正确
- [ ] 高亮显示正常

---

### 2.7 编写单元测试

**任务 ID**: P5-T07  
**优先级**: 🟡 高  
**预计工时**: 2h

**验收标准**:
- [ ] 测试覆盖率 >= 80%
- [ ] 所有测试通过

---

### 2.8 提交代码

**任务 ID**: P5-T08  
**优先级**: 🔴 最高  
**预计工时**: 0.5h

**验收标准**:
- [ ] 代码提交完成

---

## 3. 完成标准

- [ ] FileManager 主组件完成
- [ ] FileTree 组件完成
- [ ] FileItem 组件完成
- [ ] FileService 服务完成
- [ ] 上下文菜单完成
- [ ] 搜索过滤完成
- [ ] 单元测试覆盖率 >= 80%
- [ ] 代码提交完成

---

**任务分配**: 子代理-02（可与 Phase6 并行）  
**开始时间**: 待定  
**完成时间**: 待定
