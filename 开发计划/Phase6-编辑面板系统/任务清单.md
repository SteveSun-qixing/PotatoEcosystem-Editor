# Phase6 - 编辑面板系统

**周期**: 1.5 周  
**优先级**: 🟡 高  
**依赖**: Phase4  
**状态**: 待开发

---

## 1. 阶段目标

实现编辑器的编辑面板系统：
- 编辑面板窗口
- 插件宿主组件（加载编辑组件）
- 配置编辑界面
- 与卡片内容同步

---

## 2. 任务列表

### 2.1 创建编辑面板主组件

**任务 ID**: P6-T01  
**优先级**: 🔴 最高  
**预计工时**: 4h

**功能说明**:
- 固定在窗口层右侧
- 显示当前选中基础卡片的编辑组件
- 无选中时显示提示信息
- 支持收起/展开

**核心代码结构**:
```vue
<!-- src/components/edit-panel/EditPanel.vue -->
<template>
  <ToolWindow>
    <div v-if="selectedBaseCard" class="edit-panel">
      <PluginHost :card-type="selectedBaseCard.type" :config="selectedBaseCard.config" />
    </div>
    <div v-else class="edit-panel__empty">
      选择一个基础卡片以编辑
    </div>
  </ToolWindow>
</template>
```

**验收标准**:
- [ ] 编辑面板显示正常
- [ ] 选中状态响应正常
- [ ] 收起/展开正常

---

### 2.2 创建插件宿主组件

**任务 ID**: P6-T02  
**优先级**: 🔴 最高  
**预计工时**: 5h

**功能说明**:
- 根据基础卡片类型加载对应的编辑组件插件
- 提供插件运行环境
- 管理插件生命周期
- 处理配置变更

**核心代码结构**:
```typescript
// src/components/edit-panel/PluginHost.vue
interface Props {
  cardType: string;      // 基础卡片类型
  config: object;        // 当前配置
}

// 加载编辑组件插件
async function loadEditorPlugin(cardType: string) {
  const sdk = inject('sdk');
  const plugin = await sdk.plugins.getRenderer(cardType);
  // 渲染插件
}
```

**验收标准**:
- [ ] 插件加载正常
- [ ] 生命周期管理正常
- [ ] 配置变更通知正常

---

### 2.3 实现配置同步

**任务 ID**: P6-T03  
**优先级**: 🔴 最高  
**预计工时**: 3h

**功能说明**:
- 编辑组件修改后自动同步到卡片状态
- 支持实时预览
- 防抖保存
- 撤销/重做支持

**核心逻辑**:
```typescript
// 配置变更处理
function handleConfigChange(newConfig: object) {
  // 1. 更新 store
  cardStore.updateBaseCardConfig(baseCardId, newConfig);
  
  // 2. 标记为未保存
  editorStore.markUnsaved();
  
  // 3. 触发预览更新
  emit('config-changed', newConfig);
}
```

**验收标准**:
- [ ] 配置同步正常
- [ ] 实时预览正常
- [ ] 防抖保存正常

---

### 2.4 创建基础编辑器组件

**任务 ID**: P6-T04  
**优先级**: 🟡 高  
**预计工时**: 3h

**功能说明**:
为没有插件的基础卡片提供默认编辑器：
- JSON 编辑器
- 表单生成器（根据 schema）

**验收标准**:
- [ ] 默认编辑器可用
- [ ] JSON 编辑正常
- [ ] 表单生成正常

---

### 2.5 实现编辑器切换动画

**任务 ID**: P6-T05  
**优先级**: 🟢 中  
**预计工时**: 1h

**功能说明**:
- 切换基础卡片时的过渡动画
- 加载状态显示

**验收标准**:
- [ ] 切换动画流畅
- [ ] 加载状态显示正常

---

### 2.6 编写单元测试

**任务 ID**: P6-T06  
**优先级**: 🟡 高  
**预计工时**: 3h

**验收标准**:
- [ ] 测试覆盖率 >= 80%
- [ ] 所有测试通过

---

### 2.7 提交代码

**任务 ID**: P6-T07  
**优先级**: 🔴 最高  
**预计工时**: 0.5h

**验收标准**:
- [ ] 代码提交完成

---

## 3. 完成标准

- [ ] EditPanel 主组件完成
- [ ] PluginHost 组件完成
- [ ] 配置同步功能完成
- [ ] 基础编辑器完成
- [ ] 单元测试覆盖率 >= 80%
- [ ] 代码提交完成

---

**任务分配**: 子代理-03（可与 Phase5 并行）  
**开始时间**: 待定  
**完成时间**: 待定
