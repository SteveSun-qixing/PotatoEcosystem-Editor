# Phase14 - åº•å±‚æœåŠ¡æ¨¡å—

**å‘¨æœŸ**: 1.5 å‘¨  
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**ä¾èµ–**: Phase2, Phase5  
**çŠ¶æ€**: å¾…å¼€å‘

---

## 1. é˜¶æ®µç›®æ ‡

å®ç°ç¼–è¾‘å™¨çš„åº•å±‚æœåŠ¡æ¨¡å—ï¼š
- FileSystemService æ–‡ä»¶ç³»ç»ŸæœåŠ¡
- CardInitializer å¡ç‰‡åˆå§‹åŒ–æ¨¡å—
- CoverMaker å°é¢åˆ¶ä½œå™¨æ¨¡å—

---

## 2. ä»»åŠ¡åˆ—è¡¨

---

## æ¨¡å—ä¸€ï¼šFileSystemService æ–‡ä»¶ç³»ç»ŸæœåŠ¡

### 2.1 å®ç°ç»Ÿä¸€æ–‡ä»¶è¯»å†™æ¥å£

**ä»»åŠ¡ ID**: P14-T01  
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**é¢„è®¡å·¥æ—¶**: 4h

**åŠŸèƒ½è¯´æ˜**:
- ç»Ÿä¸€çš„æ–‡ä»¶è¯»å†™ APIï¼Œå…¼å®¹ Electron å’Œ Web ç¯å¢ƒ
- Electron ç¯å¢ƒä½¿ç”¨ Node.js fs æ¨¡å—
- Web ç¯å¢ƒä½¿ç”¨ File System Access API æˆ– IndexedDB
- è‡ªåŠ¨æ£€æµ‹è¿è¡Œç¯å¢ƒå¹¶åˆ‡æ¢å®ç°

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/file-system/FileSystemService.ts
export interface IFileSystemService {
  readFile(path: string): Promise<Uint8Array>;
  writeFile(path: string, data: Uint8Array): Promise<void>;
  readTextFile(path: string, encoding?: string): Promise<string>;
  writeTextFile(path: string, content: string, encoding?: string): Promise<void>;
  exists(path: string): Promise<boolean>;
  isDirectory(path: string): Promise<boolean>;
  isFile(path: string): Promise<boolean>;
}

export class FileSystemService implements IFileSystemService {
  private adapter: IFileSystemAdapter;
  
  constructor() {
    this.adapter = this.detectAdapter();
  }
  
  private detectAdapter(): IFileSystemAdapter {
    // æ ¹æ®ç¯å¢ƒé€‰æ‹©é€‚é…å™¨
  }
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] Electron ç¯å¢ƒæ–‡ä»¶è¯»å†™æ­£å¸¸
- [ ] Web ç¯å¢ƒæ–‡ä»¶è¯»å†™æ­£å¸¸
- [ ] ç¯å¢ƒè‡ªåŠ¨æ£€æµ‹æ­£ç¡®
- [ ] ç¼–ç è½¬æ¢æ­£ç¡®

---

### 2.2 å®ç°å·¥ä½œåŒºç›®å½•ç®¡ç†

**ä»»åŠ¡ ID**: P14-T02  
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**é¢„è®¡å·¥æ—¶**: 3h

**åŠŸèƒ½è¯´æ˜**:
- å·¥ä½œåŒºæ ¹ç›®å½•è®¾ç½®ä¸è·å–
- å·¥ä½œåŒºç›®å½•ç»“æ„éªŒè¯
- å·¥ä½œåŒºé…ç½®æ–‡ä»¶ç®¡ç†
- ç›®å½•è·¯å¾„æ ‡å‡†åŒ–å¤„ç†

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/file-system/WorkspaceManager.ts
export class WorkspaceManager {
  private rootPath: string;
  
  async setWorkspace(path: string): Promise<void>;
  getWorkspacePath(): string;
  async validateWorkspace(): Promise<ValidationResult>;
  async initializeWorkspace(): Promise<void>;
  resolvePath(relativePath: string): string;
  getRelativePath(absolutePath: string): string;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] å·¥ä½œåŒºè®¾ç½®æ­£å¸¸
- [ ] ç›®å½•éªŒè¯æ­£ç¡®
- [ ] è·¯å¾„è§£ææ­£ç¡®
- [ ] é…ç½®æ–‡ä»¶ç®¡ç†æ­£å¸¸

---

### 2.3 å®ç°å¡ç‰‡æ–‡ä»¶å¤¹æ“ä½œ

**ä»»åŠ¡ ID**: P14-T03  
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**é¢„è®¡å·¥æ—¶**: 3h

**åŠŸèƒ½è¯´æ˜**:
- å¡ç‰‡æ–‡ä»¶å¤¹åˆ›å»ºï¼ˆåŒ…å«æ ‡å‡†ç›®å½•ç»“æ„ï¼‰
- å¡ç‰‡æ–‡ä»¶å¤¹åˆ é™¤ï¼ˆç§»åˆ°å›æ”¶ç«™ï¼‰
- å¡ç‰‡æ–‡ä»¶å¤¹å¤åˆ¶
- å¡ç‰‡æ–‡ä»¶å¤¹ç§»åŠ¨
- å¡ç‰‡æ–‡ä»¶å¤¹é‡å‘½å

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/file-system/CardFolderOperations.ts
export class CardFolderOperations {
  async createCardFolder(parentPath: string, cardId: string): Promise<string>;
  async deleteCardFolder(cardPath: string, toTrash?: boolean): Promise<void>;
  async copyCardFolder(sourcePath: string, destPath: string): Promise<string>;
  async moveCardFolder(sourcePath: string, destPath: string): Promise<string>;
  async renameCardFolder(cardPath: string, newName: string): Promise<string>;
  async listCardFolders(directoryPath: string): Promise<CardFolderInfo[]>;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ–‡ä»¶å¤¹åˆ›å»ºæ­£å¸¸
- [ ] æ–‡ä»¶å¤¹åˆ é™¤æ­£å¸¸ï¼ˆå›æ”¶ç«™ï¼‰
- [ ] æ–‡ä»¶å¤¹å¤åˆ¶/ç§»åŠ¨æ­£å¸¸
- [ ] é‡å‘½åæ­£å¸¸

---

### 2.4 å®ç°æ–‡ä»¶å˜æ›´ç›‘å¬

**ä»»åŠ¡ ID**: P14-T04  
**ä¼˜å…ˆçº§**: ğŸŸ¡ é«˜  
**é¢„è®¡å·¥æ—¶**: 3h

**åŠŸèƒ½è¯´æ˜**:
- ç›‘å¬å·¥ä½œåŒºæ–‡ä»¶å˜æ›´
- æ”¯æŒæ–‡ä»¶åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤äº‹ä»¶
- é˜²æŠ–å¤„ç†é¿å…é¢‘ç¹è§¦å‘
- æ”¯æŒç›‘å¬ç‰¹å®šç›®å½•æˆ–æ–‡ä»¶

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/file-system/FileWatcher.ts
export interface FileChangeEvent {
  type: 'create' | 'modify' | 'delete';
  path: string;
  timestamp: number;
}

export class FileWatcher {
  watch(path: string, callback: (event: FileChangeEvent) => void): WatchHandle;
  watchDirectory(path: string, options: WatchOptions): WatchHandle;
  unwatch(handle: WatchHandle): void;
  unwatchAll(): void;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ–‡ä»¶å˜æ›´äº‹ä»¶æ­£ç¡®è§¦å‘
- [ ] é˜²æŠ–å¤„ç†æ­£å¸¸
- [ ] ç›‘å¬/å–æ¶ˆç›‘å¬æ­£å¸¸
- [ ] å†…å­˜ç®¡ç†æ­£ç¡®ï¼ˆæ— æ³„æ¼ï¼‰

---

### 2.5 å®ç°ä¸ WorkspaceService çš„é›†æˆ

**ä»»åŠ¡ ID**: P14-T05  
**ä¼˜å…ˆçº§**: ğŸŸ¡ é«˜  
**é¢„è®¡å·¥æ—¶**: 2h

**åŠŸèƒ½è¯´æ˜**:
- ä¸ Phase5 çš„ WorkspaceService é›†æˆ
- æä¾›åº•å±‚æ–‡ä»¶æ“ä½œæ”¯æŒ
- äº‹ä»¶é€šçŸ¥æœºåˆ¶
- çŠ¶æ€åŒæ­¥

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/file-system/index.ts
export function setupFileSystemService(sdk: ChipsSDK): FileSystemService {
  const service = new FileSystemService();
  
  // æ³¨å†Œåˆ° SDK
  sdk.registerService('fileSystem', service);
  
  // ä¸ WorkspaceService é›†æˆ
  sdk.on('workspace:changed', (path) => {
    service.setWorkspace(path);
  });
  
  return service;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] ä¸ WorkspaceService æ­£å¸¸é›†æˆ
- [ ] äº‹ä»¶é€šçŸ¥æ­£å¸¸
- [ ] çŠ¶æ€åŒæ­¥æ­£ç¡®

---

## æ¨¡å—äºŒï¼šCardInitializer å¡ç‰‡åˆå§‹åŒ–æ¨¡å—

### 2.6 å®ç°å¡ç‰‡ ID ç”Ÿæˆ

**ä»»åŠ¡ ID**: P14-T06  
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**é¢„è®¡å·¥æ—¶**: 2h

**åŠŸèƒ½è¯´æ˜**:
- ç”Ÿæˆ 10 ä½ 62 è¿›åˆ¶å”¯ä¸€ ID
- 62 è¿›åˆ¶å­—ç¬¦é›†ï¼š0-9, a-z, A-Z
- ä¿è¯å”¯ä¸€æ€§ï¼ˆæ—¶é—´æˆ³ + éšæœºæ•°ï¼‰
- ID æ ¼å¼éªŒè¯

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/card-initializer/CardIdGenerator.ts
const BASE62_CHARS = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';

export class CardIdGenerator {
  generate(): string;
  validate(id: string): boolean;
  parse(id: string): { timestamp: number; random: number };
  
  private toBase62(num: bigint, length: number): string;
  private fromBase62(str: string): bigint;
}

// ç¤ºä¾‹ ID: "aB3xK9mN2Q"
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç”Ÿæˆçš„ ID ä¸º 10 ä½
- [ ] ID ä»…åŒ…å« 62 è¿›åˆ¶å­—ç¬¦
- [ ] ID å”¯ä¸€æ€§éªŒè¯é€šè¿‡
- [ ] ID æ ¼å¼éªŒè¯æ­£ç¡®

---

### 2.7 å®ç°å¡ç‰‡ç›®å½•ç»“æ„åˆ›å»º

**ä»»åŠ¡ ID**: P14-T07  
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**é¢„è®¡å·¥æ—¶**: 2h

**åŠŸèƒ½è¯´æ˜**:
- æ ¹æ®å¡ç‰‡ ID åˆ›å»ºæ ‡å‡†ç›®å½•ç»“æ„
- åˆ›å»ºå¿…è¦çš„å­ç›®å½•
- è®¾ç½®ç›®å½•æƒé™ï¼ˆå¦‚é€‚ç”¨ï¼‰

**æ ‡å‡†ç›®å½•ç»“æ„**:
```
{cardId}/
â”œâ”€â”€ metadata.yaml      # å¡ç‰‡å…ƒæ•°æ®
â”œâ”€â”€ structure.yaml     # å¡ç‰‡ç»“æ„
â”œâ”€â”€ cover/            # å°é¢èµ„æº
â”‚   â””â”€â”€ cover.html    # å°é¢æ–‡ä»¶
â”œâ”€â”€ resources/        # èµ„æºæ–‡ä»¶
â””â”€â”€ cache/           # ç¼“å­˜ç›®å½•
```

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/card-initializer/CardDirectoryCreator.ts
export class CardDirectoryCreator {
  async create(parentPath: string, cardId: string): Promise<CardDirectory>;
  async validate(cardPath: string): Promise<ValidationResult>;
  async repair(cardPath: string): Promise<void>;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] ç›®å½•ç»“æ„åˆ›å»ºæ­£ç¡®
- [ ] å­ç›®å½•åˆ›å»ºå®Œæ•´
- [ ] ç›®å½•éªŒè¯åŠŸèƒ½æ­£å¸¸
- [ ] ç›®å½•ä¿®å¤åŠŸèƒ½æ­£å¸¸

---

### 2.8 å®ç° metadata.yaml åˆå§‹åŒ–

**ä»»åŠ¡ ID**: P14-T08  
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**é¢„è®¡å·¥æ—¶**: 2h

**åŠŸèƒ½è¯´æ˜**:
- åˆ›å»ºé»˜è®¤ metadata.yaml æ–‡ä»¶
- åŒ…å«å¡ç‰‡åŸºæœ¬ä¿¡æ¯ï¼ˆIDã€åç§°ã€åˆ›å»ºæ—¶é—´ç­‰ï¼‰
- æ”¯æŒè‡ªå®šä¹‰åˆå§‹å€¼
- YAML æ ¼å¼éªŒè¯

**é»˜è®¤å†…å®¹**:
```yaml
id: "{cardId}"
name: "æœªå‘½åå¡ç‰‡"
type: "basic"
created: "{timestamp}"
modified: "{timestamp}"
version: "1.0.0"
author: ""
tags: []
description: ""
```

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/card-initializer/MetadataInitializer.ts
export interface CardMetadata {
  id: string;
  name: string;
  type: string;
  created: string;
  modified: string;
  version: string;
  author?: string;
  tags?: string[];
  description?: string;
}

export class MetadataInitializer {
  async create(cardPath: string, options?: Partial<CardMetadata>): Promise<void>;
  async read(cardPath: string): Promise<CardMetadata>;
  async update(cardPath: string, updates: Partial<CardMetadata>): Promise<void>;
  async validate(cardPath: string): Promise<ValidationResult>;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] metadata.yaml åˆ›å»ºæ­£ç¡®
- [ ] é»˜è®¤å€¼å¡«å……æ­£ç¡®
- [ ] è‡ªå®šä¹‰åˆå§‹å€¼æ­£å¸¸
- [ ] YAML æ ¼å¼æ­£ç¡®

---

### 2.9 å®ç° structure.yaml åˆå§‹åŒ–

**ä»»åŠ¡ ID**: P14-T09  
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**é¢„è®¡å·¥æ—¶**: 2h

**åŠŸèƒ½è¯´æ˜**:
- åˆ›å»ºé»˜è®¤ structure.yaml æ–‡ä»¶
- å®šä¹‰å¡ç‰‡å†…å®¹ç»“æ„
- æ”¯æŒä¸åŒå¡ç‰‡ç±»å‹çš„æ¨¡æ¿
- ç»“æ„éªŒè¯

**é»˜è®¤å†…å®¹**:
```yaml
version: "1.0.0"
canvas:
  width: 400
  height: 300
  background: "#ffffff"
layers: []
components: []
```

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/card-initializer/StructureInitializer.ts
export interface CardStructure {
  version: string;
  canvas: CanvasConfig;
  layers: Layer[];
  components: Component[];
}

export class StructureInitializer {
  async create(cardPath: string, template?: string): Promise<void>;
  async read(cardPath: string): Promise<CardStructure>;
  async update(cardPath: string, structure: CardStructure): Promise<void>;
  getTemplate(templateName: string): CardStructure;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] structure.yaml åˆ›å»ºæ­£ç¡®
- [ ] æ¨¡æ¿ç³»ç»Ÿæ­£å¸¸
- [ ] ç»“æ„éªŒè¯æ­£ç¡®
- [ ] YAML æ ¼å¼æ­£ç¡®

---

### 2.10 å®ç°é»˜è®¤å°é¢åˆ›å»º

**ä»»åŠ¡ ID**: P14-T10  
**ä¼˜å…ˆçº§**: ğŸŸ¡ é«˜  
**é¢„è®¡å·¥æ—¶**: 2h

**åŠŸèƒ½è¯´æ˜**:
- åˆ›å»ºé»˜è®¤å°é¢æ–‡ä»¶ cover/cover.html
- é»˜è®¤å°é¢æ˜¾ç¤ºå¡ç‰‡åç§°å’Œå›¾æ ‡
- æ”¯æŒä¸åŒæ ·å¼æ¨¡æ¿
- è‡ªåŠ¨é€‚é…å¡ç‰‡æ¯”ä¾‹

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/card-initializer/DefaultCoverCreator.ts
export class DefaultCoverCreator {
  async create(cardPath: string, options?: CoverOptions): Promise<void>;
  async createFromTemplate(cardPath: string, template: string): Promise<void>;
  getDefaultTemplate(): string;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] é»˜è®¤å°é¢åˆ›å»ºæ­£ç¡®
- [ ] å°é¢æ˜¾ç¤ºæ­£å¸¸
- [ ] æ¨¡æ¿ç³»ç»Ÿæ­£å¸¸
- [ ] æ¯”ä¾‹é€‚é…æ­£ç¡®

---

## æ¨¡å—ä¸‰ï¼šCoverMaker å°é¢åˆ¶ä½œå™¨æ¨¡å—

### 2.11 å®ç°å›¾ç‰‡æ–‡ä»¶åˆ›å»ºå°é¢

**ä»»åŠ¡ ID**: P14-T11  
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**é¢„è®¡å·¥æ—¶**: 3h

**åŠŸèƒ½è¯´æ˜**:
- ä»æœ¬åœ°å›¾ç‰‡æ–‡ä»¶åˆ›å»ºå°é¢
- æ”¯æŒ PNGã€JPGã€GIFã€WebP æ ¼å¼
- å›¾ç‰‡è£å‰ªå’Œç¼©æ”¾
- ç”Ÿæˆå°é¢ HTML æ–‡ä»¶

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/cover-maker/ImageCoverCreator.ts
export interface ImageCoverOptions {
  fit: 'cover' | 'contain' | 'fill' | 'none';
  position: 'center' | 'top' | 'bottom' | 'left' | 'right';
  quality?: number;
}

export class ImageCoverCreator {
  async createFromFile(imagePath: string, cardPath: string, options?: ImageCoverOptions): Promise<void>;
  async createFromBlob(blob: Blob, cardPath: string, options?: ImageCoverOptions): Promise<void>;
  async preview(imagePath: string, options?: ImageCoverOptions): Promise<string>;
  
  private generateHtml(imageData: string, options: ImageCoverOptions): string;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ”¯æŒæ‰€æœ‰æŒ‡å®šå›¾ç‰‡æ ¼å¼
- [ ] è£å‰ªå’Œç¼©æ”¾æ­£å¸¸
- [ ] å°é¢ HTML ç”Ÿæˆæ­£ç¡®
- [ ] é¢„è§ˆåŠŸèƒ½æ­£å¸¸

---

### 2.12 å®ç° HTML ä»£ç åˆ›å»ºå°é¢

**ä»»åŠ¡ ID**: P14-T12  
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**é¢„è®¡å·¥æ—¶**: 3h

**åŠŸèƒ½è¯´æ˜**:
- ä»ç²˜è´´çš„ HTML ä»£ç åˆ›å»ºå°é¢
- HTML ä»£ç æ¸…ç†å’ŒéªŒè¯
- èµ„æºæå–å’Œæœ¬åœ°åŒ–
- å®‰å…¨æ€§æ£€æŸ¥ï¼ˆç§»é™¤è„šæœ¬ç­‰ï¼‰

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/cover-maker/HtmlCoverCreator.ts
export interface HtmlCoverOptions {
  sanitize?: boolean;          // æ˜¯å¦æ¸…ç†å±é™©ä»£ç 
  extractResources?: boolean;  // æ˜¯å¦æå–å¤–éƒ¨èµ„æº
  inlineStyles?: boolean;      // æ˜¯å¦å†…è”æ ·å¼
}

export class HtmlCoverCreator {
  async createFromHtml(html: string, cardPath: string, options?: HtmlCoverOptions): Promise<void>;
  async validate(html: string): Promise<ValidationResult>;
  async sanitize(html: string): Promise<string>;
  async extractResources(html: string, cardPath: string): Promise<string>;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] HTML ä»£ç ç²˜è´´æ­£å¸¸
- [ ] ä»£ç æ¸…ç†æ­£ç¡®
- [ ] èµ„æºæå–æ­£å¸¸
- [ ] å®‰å…¨æ€§æ£€æŸ¥é€šè¿‡

---

### 2.13 å®ç° ZIP å‹ç¼©åŒ…åˆ›å»ºå°é¢

**ä»»åŠ¡ ID**: P14-T13  
**ä¼˜å…ˆçº§**: ğŸŸ¡ é«˜  
**é¢„è®¡å·¥æ—¶**: 3h

**åŠŸèƒ½è¯´æ˜**:
- ä» ZIP å‹ç¼©åŒ…è§£æåˆ›å»ºå°é¢
- è‡ªåŠ¨è¯†åˆ«å…¥å£æ–‡ä»¶ï¼ˆindex.htmlï¼‰
- è§£å‹èµ„æºåˆ°å°é¢ç›®å½•
- è·¯å¾„å¼•ç”¨ä¿®æ­£

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/cover-maker/ZipCoverCreator.ts
export interface ZipCoverOptions {
  entryFile?: string;           // å…¥å£æ–‡ä»¶åï¼Œé»˜è®¤ index.html
  extractAll?: boolean;         // æ˜¯å¦è§£å‹æ‰€æœ‰æ–‡ä»¶
  overwrite?: boolean;          // æ˜¯å¦è¦†ç›–ç°æœ‰æ–‡ä»¶
}

export class ZipCoverCreator {
  async createFromZip(zipPath: string, cardPath: string, options?: ZipCoverOptions): Promise<void>;
  async createFromBlob(blob: Blob, cardPath: string, options?: ZipCoverOptions): Promise<void>;
  async listContents(zipPath: string): Promise<ZipEntry[]>;
  async extractEntry(zipPath: string, entryName: string): Promise<Uint8Array>;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] ZIP è§£ææ­£å¸¸
- [ ] å…¥å£æ–‡ä»¶è¯†åˆ«æ­£ç¡®
- [ ] èµ„æºè§£å‹æ­£å¸¸
- [ ] è·¯å¾„ä¿®æ­£æ­£ç¡®

---

### 2.14 å®ç°å¿«é€Ÿåˆ¶ä½œå™¨æ¨¡æ¿

**ä»»åŠ¡ ID**: P14-T14  
**ä¼˜å…ˆçº§**: ğŸŸ¡ é«˜  
**é¢„è®¡å·¥æ—¶**: 3h

**åŠŸèƒ½è¯´æ˜**:
- æä¾›é¢„ç½®å°é¢æ¨¡æ¿
- æ¨¡æ¿å˜é‡æ›¿æ¢ï¼ˆæ ‡é¢˜ã€é¢œè‰²ã€å›¾æ ‡ç­‰ï¼‰
- æ¨¡æ¿é¢„è§ˆ
- è‡ªå®šä¹‰æ¨¡æ¿ç®¡ç†

**é¢„ç½®æ¨¡æ¿**:
- ç®€çº¦æ–‡å­—ï¼šçº¯è‰²èƒŒæ™¯ + æ ‡é¢˜æ–‡å­—
- æ¸å˜èƒŒæ™¯ï¼šæ¸å˜è‰² + æ ‡é¢˜
- å›¾æ ‡æ¨¡æ¿ï¼šå›¾æ ‡ + æ ‡é¢˜
- å¡ç‰‡é¢„è§ˆï¼šè¿·ä½ å¡ç‰‡é¢„è§ˆæ ·å¼

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/cover-maker/TemplateManager.ts
export interface CoverTemplate {
  id: string;
  name: string;
  preview: string;
  variables: TemplateVariable[];
  html: string;
}

export interface TemplateVariable {
  name: string;
  type: 'text' | 'color' | 'image' | 'number';
  default: any;
  label: string;
}

export class TemplateManager {
  getBuiltinTemplates(): CoverTemplate[];
  getTemplate(id: string): CoverTemplate | null;
  async renderTemplate(id: string, variables: Record<string, any>): Promise<string>;
  async createFromTemplate(templateId: string, cardPath: string, variables: Record<string, any>): Promise<void>;
  
  // è‡ªå®šä¹‰æ¨¡æ¿
  async saveCustomTemplate(template: CoverTemplate): Promise<void>;
  async deleteCustomTemplate(id: string): Promise<void>;
  getCustomTemplates(): CoverTemplate[];
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] é¢„ç½®æ¨¡æ¿å¯ç”¨
- [ ] å˜é‡æ›¿æ¢æ­£ç¡®
- [ ] é¢„è§ˆåŠŸèƒ½æ­£å¸¸
- [ ] è‡ªå®šä¹‰æ¨¡æ¿ç®¡ç†æ­£å¸¸

---

### 2.15 å®ç°å°é¢æ¯”ä¾‹ç®¡ç†

**ä»»åŠ¡ ID**: P14-T15  
**ä¼˜å…ˆçº§**: ğŸŸ¡ é«˜  
**é¢„è®¡å·¥æ—¶**: 2h

**åŠŸèƒ½è¯´æ˜**:
- å°é¢æ¯”ä¾‹é…ç½®ï¼ˆ4:3ã€16:9ã€1:1ã€è‡ªå®šä¹‰ï¼‰
- æ¯”ä¾‹è½¬æ¢æ—¶çš„å†…å®¹é€‚é…
- æ¯”ä¾‹é¢„è®¾ç®¡ç†
- ä¸å¡ç‰‡å°ºå¯¸è”åŠ¨

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
// src/core/services/cover-maker/AspectRatioManager.ts
export interface AspectRatio {
  name: string;
  width: number;
  height: number;
}

export const PRESET_RATIOS: AspectRatio[] = [
  { name: '4:3', width: 4, height: 3 },
  { name: '16:9', width: 16, height: 9 },
  { name: '1:1', width: 1, height: 1 },
  { name: '3:2', width: 3, height: 2 },
];

export class AspectRatioManager {
  getPresets(): AspectRatio[];
  calculateDimensions(ratio: AspectRatio, baseWidth: number): { width: number; height: number };
  async applyRatio(cardPath: string, ratio: AspectRatio): Promise<void>;
  async adaptContent(cardPath: string, newRatio: AspectRatio, fit: 'cover' | 'contain'): Promise<void>;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] æ¯”ä¾‹é…ç½®æ­£å¸¸
- [ ] å†…å®¹é€‚é…æ­£ç¡®
- [ ] é¢„è®¾ç®¡ç†æ­£å¸¸
- [ ] ä¸å¡ç‰‡å°ºå¯¸è”åŠ¨æ­£ç¡®

---

### 2.16 ç¼–å†™å•å…ƒæµ‹è¯•

**ä»»åŠ¡ ID**: P14-T16  
**ä¼˜å…ˆçº§**: ğŸŸ¡ é«˜  
**é¢„è®¡å·¥æ—¶**: 4h

**æµ‹è¯•èŒƒå›´**:
- FileSystemService æ‰€æœ‰æ–¹æ³•
- CardInitializer æ‰€æœ‰æ–¹æ³•
- CoverMaker æ‰€æœ‰æ–¹æ³•

**éªŒæ”¶æ ‡å‡†**:
- [ ] æµ‹è¯•è¦†ç›–ç‡ >= 80%
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] è¾¹ç•Œæƒ…å†µè¦†ç›–

---

### 2.17 æäº¤ä»£ç 

**ä»»åŠ¡ ID**: P14-T17  
**ä¼˜å…ˆçº§**: ğŸ”´ æœ€é«˜  
**é¢„è®¡å·¥æ—¶**: 0.5h

**éªŒæ”¶æ ‡å‡†**:
- [ ] ä»£ç æäº¤å®Œæˆ
- [ ] æäº¤ä¿¡æ¯è§„èŒƒ

---

## 3. å®Œæˆæ ‡å‡†

### FileSystemService
- [ ] ç»Ÿä¸€æ–‡ä»¶è¯»å†™æ¥å£å®Œæˆ
- [ ] å·¥ä½œåŒºç›®å½•ç®¡ç†å®Œæˆ
- [ ] å¡ç‰‡æ–‡ä»¶å¤¹æ“ä½œå®Œæˆ
- [ ] æ–‡ä»¶å˜æ›´ç›‘å¬å®Œæˆ
- [ ] ä¸ WorkspaceService é›†æˆå®Œæˆ

### CardInitializer
- [ ] å¡ç‰‡ ID ç”Ÿæˆå®Œæˆ
- [ ] å¡ç‰‡ç›®å½•ç»“æ„åˆ›å»ºå®Œæˆ
- [ ] metadata.yaml åˆå§‹åŒ–å®Œæˆ
- [ ] structure.yaml åˆå§‹åŒ–å®Œæˆ
- [ ] é»˜è®¤å°é¢åˆ›å»ºå®Œæˆ

### CoverMaker
- [ ] å›¾ç‰‡æ–‡ä»¶åˆ›å»ºå°é¢å®Œæˆ
- [ ] HTML ä»£ç åˆ›å»ºå°é¢å®Œæˆ
- [ ] ZIP å‹ç¼©åŒ…åˆ›å»ºå°é¢å®Œæˆ
- [ ] å¿«é€Ÿåˆ¶ä½œå™¨æ¨¡æ¿å®Œæˆ
- [ ] å°é¢æ¯”ä¾‹ç®¡ç†å®Œæˆ

### è´¨é‡ä¿è¯
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ >= 80%
- [ ] ä»£ç æäº¤å®Œæˆ

---

**ä»»åŠ¡åˆ†é…**: å­ä»£ç†ï¼ˆå¯ä¸ Phase5-Phase9 å¹¶è¡Œï¼‰  
**å¼€å§‹æ—¶é—´**: å¾…å®š  
**å®Œæˆæ—¶é—´**: å¾…å®š
