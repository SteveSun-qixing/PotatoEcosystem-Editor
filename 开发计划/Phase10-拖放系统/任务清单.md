# Phase10 - 拖放系统

**周期**: 1 周  
**优先级**: 🟡 高  
**依赖**: Phase4, Phase7  
**状态**: 待开发

---

## 1. 阶段目标

实现编辑器的拖放系统：
- 从操作系统拖动文件
- 从卡箱库拖动卡片类型
- 在卡片内拖动调整基础卡片顺序
- 拖动卡片到另一个卡片（嵌套）
- 视觉反馈（预览、指示线）

---

## 2. 任务列表

### 2.1 创建拖放管理器

**任务 ID**: P10-T01  
**优先级**: 🔴 最高  
**预计工时**: 4h

**功能说明**:
- 统一管理所有拖放操作
- 拖放类型识别
- 目标区域检测
- 调用 Foundation.DragDropSystem

**核心代码结构**:
```typescript
// src/core/drag-drop-manager.ts
export class DragDropManager {
  // 注册拖放源
  registerSource(id: string, config: DragSourceConfig): void;
  
  // 注册拖放目标
  registerTarget(id: string, config: DropTargetConfig): void;
  
  // 处理拖放
  handleDrop(source: DragSource, target: DropTarget): Promise<void>;
}
```

**验收标准**:
- [ ] 拖放管理正常
- [ ] 类型识别正确
- [ ] 目标检测正常

---

### 2.2 实现文件拖入功能

**任务 ID**: P10-T02  
**优先级**: 🔴 最高  
**预计工时**: 3h

**功能说明**:
- 从操作系统拖动文件到编辑器
- 识别文件类型（图片、视频、音频、卡片文件等）
- 创建对应类型的基础卡片

**验收标准**:
- [ ] 文件拖入正常
- [ ] 类型识别正确
- [ ] 卡片创建正常

---

### 2.3 实现卡片内排序拖放

**任务 ID**: P10-T03  
**优先级**: 🟡 高  
**预计工时**: 3h

**功能说明**:
- 在复合卡片内拖动基础卡片
- 显示插入位置指示线
- 根据鼠标位置决定插入位置

**验收标准**:
- [ ] 排序拖放正常
- [ ] 指示线显示正确
- [ ] 插入位置正确

---

### 2.4 实现卡片嵌套拖放

**任务 ID**: P10-T04  
**优先级**: 🟡 高  
**预计工时**: 3h

**功能说明**:
- 拖动一个卡片到另一个卡片
- 被拖动的卡片作为嵌套卡片插入

**验收标准**:
- [ ] 嵌套拖放正常
- [ ] 视觉反馈正确

---

### 2.5 实现拖放视觉反馈

**任务 ID**: P10-T05  
**优先级**: 🟡 高  
**预计工时**: 2h

**功能说明**:
- 拖动时显示预览
- 有效/无效区域高亮
- 禁止拖放时显示禁止图标

**验收标准**:
- [ ] 预览显示正常
- [ ] 高亮显示正常
- [ ] 禁止图标显示正常

---

### 2.6 编写单元测试

**任务 ID**: P10-T06  
**优先级**: 🟡 高  
**预计工时**: 3h

**验收标准**:
- [ ] 测试覆盖率 >= 80%

---

### 2.7 提交代码

**任务 ID**: P10-T07  
**优先级**: 🔴 最高  
**预计工时**: 0.5h

**验收标准**:
- [ ] 代码提交完成

---

## 3. 完成标准

- [ ] DragDropManager 完成
- [ ] 文件拖入功能完成
- [ ] 卡片内排序拖放完成
- [ ] 卡片嵌套拖放完成
- [ ] 视觉反馈完成
- [ ] 单元测试覆盖率 >= 80%
- [ ] 代码提交完成

---

**任务分配**: 子代理-06  
**开始时间**: 待定  
**完成时间**: 待定
