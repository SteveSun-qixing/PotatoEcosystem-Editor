# 卡片编辑引擎 - 产品概述

**版本**: 2.0.0  
**更新时间**: 2026-01-31  
**状态**: 正式版

---

## 1. 产品定位

### 1.1 核心定位

卡片编辑引擎（Chips Editor）是薯片生态的核心软件平台，用于创建和编辑复合卡片。编辑引擎本身是框架，实际的编辑处理功能由对应的插件提供。

**关键特征**：
- **平台框架**: 编辑引擎是平台框架而非完整编辑器，提供窗口管理、文件管理、拖拽处理、保存机制等基础能力
- **插件驱动**: 布局模式、编辑组件、渲染器等功能完全由插件实现，引擎负责接收用户操作，传达给相应插件进行数据处理
- **实时保存**: 用户操作完成后数据自动保存并刷新，不需要手动保存
- **微内核架构**: 通过微内核路由调用所有模块，模块间完全解耦

### 1.2 架构定位

编辑引擎在薯片生态中的位置：

```
┌─────────────────────────────────────────────────┐
│          编辑引擎 (Chips Editor)                 │
│   - 布局管理器    - 窗口管理器                   │
│   - 文件管理器    - 拖拽处理器                   │
│   - 保存管理器    - 使用薯片组件库构建界面        │
└────────────────────┬────────────────────────────┘
                     │ 通过微内核路由
┌────────────────────┴────────────────────────────┐
│         薯片公共基础层 (Chips Foundation)        │
│   - 通用媒体组件   - 文本处理组件                │
│   - 文件处理模块   - 网络模块                    │
│   - 界面组件库     - 系统服务                    │
└────────────────────┬────────────────────────────┘
                     │ 通过微内核路由
┌────────────────────┴────────────────────────────┐
│          薯片微内核 (Chips Core)                 │
│   - 中心路由       - 模块注册                    │
│   - 插件加载       - 文件识别                    │
│   - 资源管理       - 事件总线                    │
└────────────────────┬────────────────────────────┘
                     │ 调用
┌────────────────────┴────────────────────────────┐
│              插件生态系统                        │
│   - 布局插件       - 编辑组件插件                │
│   - 渲染器插件     - 主题包                      │
└─────────────────────────────────────────────────┘
```

### 1.3 依赖关系

**编辑引擎使用公共基础层的组件**：
- **媒体组件**: 视频播放器、音频播放器、图片查看器、3D渲染器
- **文本组件**: 富文本渲染器、Markdown解析器、代码高亮器、文本编辑器
- **文件处理**: ZIP处理器、文件识别器、格式转换器
- **网络模块**: HTTP客户端、下载管理器、缓存管理器
- **界面组件**: 基础控件库、窗口管理器、拖拽系统、网页框架组件
- **系统服务**: 数据序列化、日志系统、多语言系统、配置管理器

**编辑引擎使用薯片组件库**：
- **基础组件**: Button、Input、Select等交互组件
- **布局组件**: Grid、Flex、Container等布局容器
- **卡片组件**: 各种基础卡片的渲染组件
- **专用组件**: ThemeProvider、ErrorBoundary等

**通过微内核路由调用**：
- 所有对公共基础层的调用通过微内核路由
- 所有对插件的调用通过微内核路由
- 编辑引擎不直接调用任何模块
- 完全遵循中心路由架构原则

### 1.4 目标用户

- **个人知识管理者**: 灵活组织和管理知识内容
- **内容创作者**: 创建富媒体卡片内容
- **项目管理者**: 管理项目任务和资料
- **教育工作者**: 制作教学卡片和学习材料
- **插件开发者**: 开发布局插件、编辑组件插件

---

## 2. 核心特性

### 2.1 多布局模式

编辑引擎支持多种布局模式，每种模式是独立的插件。用户可以安装更多布局插件，在设置中选择默认布局，也可以临时切换布局。

#### 2.1.1 无限画布布局

无限画布布局采用两层界面设计：

**桌面层（底层）**：
- 无限大的画布，背景显示网格图案
- 用户可以在桌面上自由摆放卡片和箱子
- 可以拖动桌面平移查看不同区域
- 可以放大缩小改变缩放比例
- 桌面没有边界限制，可以无限扩展
- 卡片和箱子窗口放置在桌面上，随桌面一起缩放和移动

**窗口层（顶层）**：
- 像一块玻璃悬浮在桌面上方
- 窗口层中的元素固定在屏幕位置，不随桌面的缩放和平移而移动
- 包含工具窗口和程序坞
- 程序坞在窗口层下方或侧边，显示所有工具组件的图标
- 工具组件最小化时变成图标保存在程序坞中，点击图标后展开成悬浮窗口
- 右下角有缩放比例滑块，用户可以拖动滑块改变桌面缩放比例

**主要工具组件窗口**：
- **文件管理器窗口**: 显示当前桌面上所有的卡片和箱子文件，可创建、打开、删除、重命名文件
- **编辑面板窗口**: 固定在窗口层右侧，显示当前选中基础卡片的编辑组件，只提供容器，界面完全由插件设计
- **卡箱库窗口**: 网格列表显示各种基础卡片类型和箱子布局类型，从卡箱库拖动到桌面创建新内容

**工具窗口特性**：
- 悬浮窗口，可以拖动改变位置，可以调整大小
- 点击收起按钮后，窗口高度缩小到只显示标题栏，内容完全隐藏
- 点击最小化后，窗口关闭，图标显示在程序坞

#### 2.1.2 工作台布局

工作台布局采用分区窗口组合方式，没有无限画布：

- **左侧**: 树状文件管理器，显示文件的层级结构
- **中间**: 预览区，显示选中的卡片或箱子内容
- **右侧**: 编辑窗口，显示编辑组件
- **底部**: 工具栏或其他辅助窗口（可选）

这些窗口可以拖动重新排列组合，可以调整大小，可以停靠到不同位置，可以创建标签页。工作台布局适合专注于单个卡片的编辑，界面更紧凑，适合小屏幕或喜欢传统界面的用户。

#### 2.1.3 未来布局模式

- **页面式布局**: 类似笔记软件，左侧页面导航，中间全屏显示一个卡片
- **看板布局**: 类似项目管理工具，横向多列结构，每列一个分类
- **网格布局**: 以网格显示卡片封面，点击进入详情
- **时间轴布局**: 按时间顺序排列卡片

第三方开发者可以开发布局插件，用户从应用市场安装后，在布局切换菜单中会出现新选项。切换布局时，所有打开的卡片保持打开状态，数据自动保存，界面适配新布局。

#### 2.1.4 布局通用功能

虽然布局可以变化，但某些核心功能是所有布局都需要提供的：
- **卡片管理**: 创建、打开、保存、删除
- **基础卡片编辑**: 添加、删除、调整顺序
- **文件管理**: 浏览、导入导出、重命名
- **系统功能**: 撤销重做、搜索、设置

这些功能由编辑引擎系统提供，布局插件通过微内核路由调用。

### 2.2 复合卡片窗口设计

复合卡片显示为竖直长条状窗口。窗口顶部是菜单栏，左边显示卡片名称，右边排列操作按钮。

**菜单栏功能**：
- **卡片名称**: 双击进入编辑状态，点击其他地方失去焦点后自动保存
- **最小化按钮**: 直接关闭窗口，窗口从桌面消失，不在程序坞显示，也不显示为封面
- **切换到封面按钮**: 关闭当前窗口，在桌面上创建封面窗口
- **设置按钮**: 打开设置窗口，可修改卡片名称、选择主题包、上传编辑封面、调整封面比例、导出卡片等
- **锁定按钮**: 切换编辑模式和查看模式，编辑模式下点击基础卡片会打开编辑面板，查看模式下可以正常与卡片内容交互
- **收起按钮**: 改变窗口显示状态，卡片窗口收起后高度缩小到十六比九比例，内容可滚动查看
- **关闭按钮**: 将窗口从桌面移除，但文件在文件管理器中保留

### 2.3 封面设计

**封面保存**：
- 封面保存在 `.card/cover.html` 文件中
- 用户在卡片设置中可以上传网页文件或图片文件作为封面

**创建方式**：
- 上传网页文件时，文件内容直接保存为 `cover.html`
- 上传图片文件时，图片保存到 `cardcover` 文件夹，系统生成包含这个图片的网页代码作为 `cover.html`
- 如果用户没有设置封面，系统使用默认封面，只显示卡片名称

**封面比例**：
- 正方形、书本比例、照片比例、标准照片、经典照片
- 纸张比例、黄金比例、电影比例、横幅比例
- 手机比例、杂志比例
- 用户可以切换横竖方向，默认是标准照片比例竖版

**封面窗口**：
- 显示卡片封面，封面通过网页框架显示，封面铺满窗口
- 下方有透明底文字显示卡片名称
- 封面窗口大小固定，比例可以在设置中调整
- 点击封面后，封面窗口关闭，展开卡片显示完整内容

### 2.4 卡片渲染

**渲染机制**：
- 复合卡片本质是一个大的网页窗口
- 窗口内部是一列小的网页框架组件，每个网页框架显示一个基础卡片
- 网页框架背景设置为透明

**渲染流程**：
- 基础卡片通过网页框架组件渲染
- 引擎通过微内核路由到基础卡片的渲染器插件
- 渲染器根据配置文件生成网页内容，在网页框架中显示

**主题系统**：
- 如果用户为复合卡片设置了主题包，主题包作为整个窗口的背景网页
- 基础卡片的网页框架叠加在主题背景上
- 主题包本质是网页代码，可以包含背景图片、装饰元素、动画效果等

**布局特性**：
- 所有基础卡片宽度与复合卡片宽度相同，高度随内容自适应
- 复合卡片有内边距
- 卡片默认全展开，显示所有基础卡片的完整内容

### 2.5 拖动操作

#### 2.5.1 从卡箱库拖动

用户从卡箱库拖动基础卡片类型到桌面空白区域：
- 拖动过程中卡片跟随鼠标
- 松开后在该位置创建新的复合卡片窗口
- 基础卡片自动添加进去

拖动基础卡片到已有复合卡片时：
- 根据鼠标位置判断插入位置
- 鼠标在某个基础卡片上方区域时，插入到该卡片上方
- 鼠标在下方区域时，插入到该卡片下方
- 拖动过程中显示插入位置的指示线，松开后卡片插入到指定位置

拖动一个复合卡片到另一个复合卡片时：
- 被拖动的复合卡片作为整体嵌套进目标卡片
- 保持完整结构

#### 2.5.2 文件拖拽支持

编辑引擎全局支持文件拖拽：
- 用户从操作系统文件管理器拖动文件到引擎任意位置，系统都能接收
- 拖到桌面空白区域时，根据文件类型自动创建对应的卡片
- 拖到已有卡片窗口时，添加到该卡片中
- 拖到编辑面板窗口时，添加到当前正在编辑的基础卡片中

**识别流程**：
- 系统通过微内核的文件识别功能判断文件类型
- 然后路由到对应的处理模块
- 比如拖入视频文件，创建视频卡片；拖入图片文件，创建图片卡片；拖入卡片文件，嵌套到当前卡片中

### 2.6 编辑面板系统

**定位与职责**：
- 编辑面板窗口固定在窗口层右侧（无限画布布局）或右侧分区（工作台布局）
- 显示当前选中基础卡片的编辑组件
- 用户选中某个基础卡片时，引擎通过微内核加载对应的编辑组件插件，显示在编辑面板中
- 编辑面板只提供容器，界面完全由插件设计
- 编辑面板不区分普通设置和高级设置，界面布局完全由插件自己决定

**工作流程**：
1. 用户点击基础卡片（编辑模式下）
2. 引擎通过微内核请求加载对应的编辑组件插件
3. 微内核路由到插件系统，加载插件代码
4. 插件组件挂载到编辑面板容器
5. 用户在编辑面板中修改数据
6. 插件通知引擎数据已修改
7. 引擎实时保存修改到文件

---

## 3. 技术架构特点

### 3.1 微内核架构

**中心路由原则** ⭐：
- 编辑引擎的所有模块通信必须经过薯片微内核作为中转
- 编辑引擎不直接调用公共基础层的任何模块
- 编辑引擎不直接调用任何插件
- 所有调用通过微内核路由系统进行

**通信机制**：
```typescript
// ✅ 正确：通过微内核路由
const response = await Core.request({
  service: "video-player.play",
  payload: { videoPath: "video.mp4" }
});

// ❌ 错误：直接调用
VideoPlayer.play("video.mp4"); // 禁止！
```

### 3.2 公共基础层依赖

编辑引擎通过微内核路由使用公共基础层提供的所有通用功能：

**媒体处理**（通过路由调用）：
- `video-player.play` - 播放视频
- `audio-player.play` - 播放音频
- `image-viewer.display` - 显示图片
- `model-3d.render` - 渲染3D模型

**文本处理**（通过路由调用）：
- `rich-text.render` - 渲染富文本
- `markdown.parse` - 解析Markdown
- `code-highlighter.highlight` - 代码高亮
- `text-editor.create` - 创建文本编辑器

**文件处理**（通过路由调用）：
- `zip-processor.create` - 创建卡片ZIP文件
- `zip-processor.extract` - 解析卡片ZIP文件
- `file-identifier.recognize` - 识别文件类型
- `format-converter.convert` - 格式转换

**界面组件**（通过路由调用）：
- `window-manager.create` - 创建窗口
- `window-manager.focus` - 聚焦窗口
- `drag-drop.handle` - 处理拖拽事件
- `iframe-wrapper.create` - 创建网页框架

**系统服务**（通过路由调用）：
- `config.get` / `config.set` - 配置管理
- `log.write` - 记录日志
- `i18n.translate` - 多语言翻译
- `event.publish` / `event.subscribe` - 事件系统

### 3.3 薯片组件库使用

编辑引擎使用薯片组件库（Chips UI Library）构建所有用户界面：

**基础组件**：
- 按钮、输入框、选择器、滑块等交互控件
- 所有组件遵循功能与样式分离原则
- 样式完全由主题包提供

**布局组件**：
- Grid、Flex、Container等布局容器
- 构建响应式界面布局

**卡片渲染组件**：
- MarkdownCard - 渲染Markdown卡片
- ImageCard - 渲染图片卡片
- VideoCard - 渲染视频卡片
- 等26种基础卡片的渲染组件

**特殊组件**：
- ThemeProvider - 主题上下文提供者
- ChipsProvider - 内核连接提供者
- ErrorBoundary - 错误边界组件

**组件使用示例**：
```vue
<template>
  <ThemeProvider :theme="currentTheme">
    <ChipsProvider>
      <div class="editor-layout">
        <FileManager />
        <Canvas />
        <EditPanel />
      </div>
    </ChipsProvider>
  </ThemeProvider>
</template>
```

### 3.4 插件化架构

**插件类型**：
- **布局插件**: 提供不同的界面布局模式（无限画布、工作台等）
- **编辑组件插件**: 提供基础卡片的编辑界面
- **渲染器插件**: 提供基础卡片的渲染逻辑
- **主题包**: 提供视觉样式和装饰

**插件加载**：
- 所有插件通过微内核加载和管理
- 引擎通过路由请求加载插件
- 插件独立安装、更新、卸载
- 插件之间完全解耦

**插件通信**：
- 插件与引擎通过微内核路由通信
- 插件获得引擎提供的 API（通过内核转发）
- 插件可以订阅系统事件（通过内核事件总线）

### 3.5 实时保存机制

**自动保存**：
- 用户操作完成后数据自动保存
- 引擎负责保存机制
- 无需手动保存按钮
- 实时刷新显示

**保存策略**：
- 防抖保存：高频操作使用防抖，避免频繁写文件
- 后台保存：保存操作在后台线程执行，不阻塞用户操作
- 增量保存：只保存变化的部分
- 冲突检测：检测外部修改，提供冲突解决机制

---

## 4. 技术选型

### 4.1 前端技术栈

**核心框架**: Vue 3 + TypeScript
- 采用 Vue 3 Composition API
- TypeScript 提供类型安全
- 使用 Pinia 进行状态管理

**UI组件**: @chips/components（薯片组件库）
- 功能与样式完全分离的组件
- 遵循薯片生态组件标准
- 支持原子级主题应用

**桌面框架**: Electron
- 跨平台桌面应用支持
- 提供文件系统访问能力
- 集成 Chromium 内核

### 4.2 公共基础层集成

编辑引擎完全依赖公共基础层，不重复实现基础功能：

**媒体播放**：
- 调用基础层的 VideoPlayer 播放视频
- 调用基础层的 AudioPlayer 播放音频
- 调用基础层的 ImageViewer 显示图片

**文本处理**：
- 调用基础层的 RichTextRenderer 渲染富文本
- 调用基础层的 MarkdownParser 解析 Markdown
- 调用基础层的 CodeHighlighter 高亮代码

**文件操作**：
- 调用基础层的 ZIPProcessor 处理卡片文件
- 调用基础层的 FileIdentifier 识别文件类型

**界面功能**：
- 调用基础层的 WindowManager 管理窗口
- 调用基础层的 DragDropSystem 处理拖拽
- 调用基础层的 IFrameWrapper 渲染基础卡片

### 4.3 通信协议

**遵循薯片协议**：
- 所有请求使用统一的消息格式
- 包含协议版本、消息ID、时间戳等标准字段
- 响应使用统一的格式
- 错误使用标准错误码

**事件系统**：
- 通过微内核事件总线发布和订阅事件
- 监听文件变化、窗口操作、插件事件等
- 使用标准的事件消息格式

---

## 5. 使用场景

### 5.1 知识管理

创建知识卡片，通过无限画布组织成知识网络，建立卡片间的关联，使用箱子分类管理。

### 5.2 项目管理

使用箱子创建项目空间，卡片记录任务、文档、资料，通过拖拽调整任务顺序和状态。

### 5.3 内容创作

创建包含文字、图片、视频、音频的多媒体卡片，使用主题美化外观，导出为网页或图片分享。

### 5.4 学习笔记

记录学习内容，创建复习卡片，使用打分卡片记录掌握程度，通过箱子组织知识体系。

---

## 6. 产品优势

### 6.1 极致模块化

- 基于微内核架构，模块完全解耦
- 使用公共基础层，避免重复开发
- 使用薯片组件库，快速构建界面
- 插件化设计，功能可扩展

### 6.2 简单易用

- 所见即所得的编辑体验
- 自动保存，无需担心数据丢失
- 直观的拖拽操作
- 无需学习复杂功能

### 6.3 灵活强大

- 多种布局模式适应不同需求
- 自由嵌套组合卡片
- 丰富的基础卡片类型
- 自定义主题外观

### 6.4 开放生态

- 插件化架构支持第三方扩展
- 标准的文件格式便于互操作
- 开放的 API 便于集成
- 跨平台支持

### 6.5 高性能

- 虚拟化渲染，支持大量窗口
- 按需加载，减少资源占用
- 视口裁剪，只渲染可见内容
- 流畅的60fps动画效果

---

## 7. 与其他软件的对比

### 7.1 vs 传统笔记软件

- ✅ 更灵活的卡片组织方式（嵌套、自由布局）
- ✅ 支持多种布局模式切换
- ✅ 强大的插件生态系统
- ✅ 更丰富的媒体类型支持
- ✅ 基于开放标准，数据不被锁定

### 7.2 vs 思维导图工具

- ✅ 不限于树状结构，支持任意组织方式
- ✅ 支持复杂的嵌套关系
- ✅ 每个卡片可包含丰富的多媒体内容
- ✅ 同时支持结构化布局和自由布局
- ✅ 内容和展示完全分离

### 7.3 vs 项目管理工具

- ✅ 更注重内容而非流程管理
- ✅ 灵活的组织方式，不限于看板模式
- ✅ 适合个人和小团队使用
- ✅ 数据完全本地化，用户完全掌控
- ✅ 可以通过布局插件实现看板等专业模式

---

## 8. 非功能需求

### 8.1 性能要求

- **UI响应时间**: < 100ms
- **文件打开时间**: < 1s（中等大小卡片）
- **布局切换时间**: < 500ms
- **拖拽帧率**: ≥ 60fps
- **窗口数量**: 支持 ≥100 个窗口流畅运行

### 8.2 兼容性要求

**操作系统**：
- macOS 10.14+
- Windows 10+
- Linux（主流发行版）

**输入设备**：
- 鼠标
- 触摸板
- 触摸屏
- 键盘

**屏幕尺寸**：
- 最小分辨率: 1280x720
- 推荐分辨率: 1920x1080 及以上

### 8.3 稳定性要求

- 错误隔离：插件错误不影响引擎主体
- 崩溃恢复：自动恢复未保存数据
- 容错机制：文件损坏时尝试恢复
- 日志记录：记录所有关键操作

### 8.4 安全性要求

- 插件沙箱：插件运行在隔离环境
- 权限管理：插件需要声明和授权权限
- 输入验证：所有用户输入必须验证
- 路径安全：防止路径遍历攻击

---

## 9. 开发路线

### 9.1 第一阶段：核心框架

- 实现编辑引擎核心框架
- 集成公共基础层和组件库
- 实现无限画布基础布局
- 实现窗口管理系统
- 实现文件管理功能
- 实现拖拽系统

### 9.2 第二阶段：编辑功能

- 实现编辑面板系统
- 开发常用基础卡片的编辑组件插件（5-10种）
- 实现实时保存机制
- 实现撤销/重做功能
- 优化性能和用户体验

### 9.3 第三阶段：扩展功能

- 实现工作台布局插件
- 开发更多基础卡片编辑组件（剩余类型）
- 实现卡箱库窗口
- 实现主题系统集成
- 建立插件开发文档

### 9.4 第四阶段：生态建设

- 建立插件市场
- 提供插件开发工具和模板
- 支持第三方开发者贡献
- 增加更多布局模式
- 优化和完善

---

## 10. 成功标准

### 10.1 功能完整性

- ✅ 实现无限画布和工作台两种基础布局
- ✅ 支持至少15种基础卡片类型的编辑
- ✅ 完整的文件管理功能
- ✅ 流畅的拖拽交互
- ✅ 实时保存和撤销/重做

### 10.2 性能指标

- ✅ 所有性能指标达标
- ✅ 支持100个窗口流畅运行
- ✅ 60fps的动画和拖拽
- ✅ 快速启动和响应

### 10.3 用户体验

- ✅ 新用户10分钟内上手
- ✅ 所有核心功能可通过拖拽完成
- ✅ 友好的错误提示和帮助
- ✅ 跨平台一致的体验

### 10.4 架构质量

- ✅ 严格遵循中心路由原则
- ✅ 完全使用公共基础层组件
- ✅ 完全使用薯片组件库构建界面
- ✅ 模块高度解耦，易于维护和扩展

---

## 11. 总结

Chips Editor 是薯片生态的核心软件平台，通过微内核架构、公共基础层和组件库的支持，实现了一个高度模块化、灵活强大的卡片编辑引擎。编辑引擎作为平台框架，提供基础能力，而具体的编辑功能由插件实现，确保了系统的可扩展性和开放性。通过直观的拖拽交互、实时保存、多布局支持等特性，为用户提供了简单易用且功能强大的卡片创建和编辑体验。
